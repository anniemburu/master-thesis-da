Namespace(batch_size=128, bin_alt=None, cat_dims=[2], cat_idx=[0], config='config/house_prices_nominal.yml', data_parallel=False, dataset='House_Prices_Nominal', direction='maximize', dropna_idx=[0], early_stopping_rounds=20, epochs=100, frequency_reg=False, gpu_ids=[0, 1], logging_period=100, miss_cat_idx=[6, 25, 30, 31, 32, 33, 35, 42, 57, 58, 60, 63, 64, 72, 73, 74], miss_num_idx=[3, 26, 59], model_name='TabNet', n_trials=99, nominal_idx=[2, 7, 12], num_bins=10, num_classes=1, num_features=80, num_idx=None, num_splits=5, objective='probabilistic_regression', one_hot_encode=True, optimize_hyperparameters=True, ordinal_encode=True, ordinal_idx=[5, 6, 8, 9, 10, 11, 13, 14, 15, 16, 21, 22, 23, 24, 25, 27, 28, 29, 30, 31, 32, 33, 35, 39, 40, 41, 42, 53, 55, 57, 58, 60, 63, 64, 65, 72, 73, 74, 78, 79], scale=True, seed=221, shuffle=True, target_encode=False, use_gpu=True, val_batch_size=256, y_distribution='normal')
Start hyperparameter optimization
Loading dataset House_Prices_Nominal...
Dataset loaded! 

(1460, 79)
Using an existing study with name 'TabNet_House_Prices_Nominal' instead of creating a new one.
In get_device
Fold 1
num_features : 79
num_classes : 1
cat_idx : [0]
nominal_idx : [1, 6, 11]
ordinal_idx : [4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 20, 21, 22, 23, 24, 26, 27, 28, 29, 30, 31, 32, 34, 38, 39, 40, 41, 52, 54, 56, 57, 59, 62, 63, 64, 71, 72, 73, 77, 78]
num_idx : None
cat_dims : [2]
bin_alt : None
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
BEFORE ANY ENCODING
num_features :79
num_classes : 1
cat_idx : [0]
nominal_idx : [1, 6, 11]
ordinal_idx : [4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 20, 21, 22, 23, 24, 26, 27, 28, 29, 30, 31, 32, 34, 38, 39, 40, 41, 52, 54, 56, 57, 59, 62, 63, 64, 71, 72, 73, 77, 78]
num_idx : None
cat_dims : [2]
bin_alt : None 


X shape : (1168, 79)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 


AFTER SEPARATING CATEGORICALS AND NUMERICALS
Numerical Index V1 : [0, 2, 3, 16, 17, 18, 19, 25, 33, 35, 36, 37, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 53, 55, 58, 60, 61, 65, 66, 67, 68, 69, 70, 74, 75, 76]
Cat Dims V1 : [3, 3, 5, 3, 6, 4, 10, 9, 6, 9, 7, 8, 15, 17, 4, 5, 6, 7, 5, 5, 5, 7, 7, 7, 6, 3, 6, 5, 8, 6, 7, 4, 6, 6, 4, 4, 5, 4, 10, 7]
Cat Idx V1 : [1, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 20, 21, 22, 23, 24, 26, 27, 28, 29, 30, 31, 32, 34, 38, 39, 40, 41, 52, 54, 56, 57, 59, 62, 63, 64, 71, 72, 73, 77, 78] 
 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 


Scaling the data...
One Hot Encoding...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
After OHE
Numerical Index V2 : [0, 2, 3, 16, 17, 18, 19, 25, 33, 35, 36, 37, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 53, 55, 58, 60, 61, 65, 66, 67, 68, 69, 70, 74, 75, 76] 


OHE Idx : [40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73]


Ordinal Idx V2: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]


Cat Dims V2 : [3, 3, 5, 3, 6, 4, 10, 9, 6, 9, 7, 8, 15, 17, 4, 5, 6, 7, 5, 5, 5, 7, 7, 7, 6, 3, 6, 5, 8, 6, 7, 4, 6, 6, 4, 4, 5, 4, 10, 7]
Cat Idx V2 : [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39] 
 

Train: [['Pave' 'None' 'Lvl' 'AllPub' 'Inside']
 ['Pave' 'None' 'Lvl' 'AllPub' 'FR2']
 ['Pave' 'None' 'Lvl' 'AllPub' 'Corner']
 ['Pave' 'None' 'Lvl' 'AllPub' 'FR2']
 ['Pave' 'None' 'Lvl' 'AllPub' 'Inside']
 ['Pave' 'None' 'Lvl' 'AllPub' 'Inside']
 ['Pave' 'None' 'Lvl' 'AllPub' 'Corner']
 ['Pave' 'None' 'Lvl' 'AllPub' 'Inside']
 ['Pave' 'None' 'Lvl' 'AllPub' 'Corner']
 ['Pave' 'None' 'Lvl' 'AllPub' 'Inside']] 
 
 
Val : (1168, 110) 
 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
After ORDINAL
Numerical Index V2 : [0, 2, 3, 16, 17, 18, 19, 25, 33, 35, 36, 37, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 53, 55, 58, 60, 61, 65, 66, 67, 68, 69, 70, 74, 75, 76] 


OHE Idx : [40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73]


Ordinal Idx V2: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]


Cat Dims V2 : [3, 3, 5, 3, 6, 4, 10, 9, 6, 9, 7, 8, 15, 17, 4, 5, 6, 7, 5, 5, 5, 7, 7, 7, 6, 3, 6, 5, 8, 6, 7, 4, 6, 6, 4, 4, 5, 4, 10, 7]
Cat Idx V2 : [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39] 
 

Train: [[2 0 4 ... -0.08549072883692027 -1.6038865594520038 0.11325845825763112]
 [2 0 4 ... -0.08549072883692027 -0.4812300464036975 -0.6383658556335169]
 [2 0 4 ... -0.08549072883692027 -1.6038865594520038 -1.389990169524665]
 ...
 [2 0 4 ... -0.08549072883692027 -0.8554488840864662 0.11325845825763112]
 [2 0 4 ... -0.08549072883692027 -1.9781053971347726 0.11325845825763112]
 [2 0 4 ... -0.08549072883692027 0.2672076289618401 -1.389990169524665]] 
 
 
Val : (1168, 110) 
 

FINISHED ENCODING
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Number of Classes B4 Bin Verifier: 8
Unique values in y_train: (array([0., 1., 2., 3., 4., 5., 6., 7.]), 8)
Unique values in y_test: (array([0., 1., 2., 3., 4., 5., 6., 7.]), 8)
No need to shift labels.
VERIFY SHIFT
Train after shift : [0 1 2 3 4 5 6 7], Length : 8
Test after shift : [0 1 2 3 4 5 6 7], Length : 8
Number of Classes After Bin Verifier: 8
In get_device
{'n_d': 53, 'n_steps': 5, 'gamma': 1.2770630730444088, 'cat_emb_dim': 2, 'n_independent': 4, 'n_shared': 1, 'momentum': 0.16405390910920947, 'mask_type': 'sparsemax', 'n_a': 53, 'cat_idxs': [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39], 'cat_dims': [3, 3, 5, 3, 6, 4, 10, 9, 6, 9, 7, 8, 15, 17, 4, 5, 6, 7, 5, 5, 5, 7, 7, 7, 6, 3, 6, 5, 8, 6, 7, 4, 6, 6, 4, 4, 5, 4, 10, 7], 'device_name': device(type='cuda')}
Trial 3 failed with parameters: {'n_d': 53, 'n_steps': 5, 'gamma': 1.2770630730444088, 'cat_emb_dim': 2, 'n_independent': 4, 'n_shared': 1, 'momentum': 0.16405390910920947, 'mask_type': 'sparsemax'} because of the following error: RuntimeError('CUDA error: device-side assert triggered\nCUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.\nFor debugging consider passing CUDA_LAUNCH_BLOCKING=1.\nCompile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.\n').
Traceback (most recent call last):
  File "/home/mburu/.local/lib/python3.8/site-packages/optuna/study/_optimize.py", line 197, in _run_trial
    value_or_values = func(trial)
  File "train.py", line 416, in __call__
    sc, time = cross_validation(model, self.X, self.y, args_cp, visual=False, save_model=False)#Dont save model during HPT
  File "train.py", line 307, in cross_validation
    loss_history, val_loss_history = curr_model.fit(X_train, y_train, X_test, y_test)  # X_val, y_val)
  File "/home/mburu/Master_Thesis/master-thesis-da/DNN_Trial/models/tabnet.py", line 79, in fit
    self.model.fit(X, y, eval_set=[(X_val, y_val)], eval_name=["eval"], eval_metric=self.metric,
  File "/home/mburu/.local/lib/python3.8/site-packages/pytorch_tabnet/abstract_model.py", line 258, in fit
    self._train_epoch(train_dataloader)
  File "/home/mburu/.local/lib/python3.8/site-packages/pytorch_tabnet/abstract_model.py", line 489, in _train_epoch
    batch_logs = self._train_batch(X, y)
  File "/home/mburu/.local/lib/python3.8/site-packages/pytorch_tabnet/abstract_model.py", line 527, in _train_batch
    output, M_loss = self.network(X)
  File "/home/mburu/anaconda3/envs/TabSurvey/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/mburu/anaconda3/envs/TabSurvey/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/mburu/.local/lib/python3.8/site-packages/pytorch_tabnet/tab_network.py", line 615, in forward
    x = self.embedder(x)
  File "/home/mburu/anaconda3/envs/TabSurvey/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/mburu/anaconda3/envs/TabSurvey/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/mburu/.local/lib/python3.8/site-packages/pytorch_tabnet/tab_network.py", line 890, in forward
    self.embeddings[cat_feat_counter](x[:, feat_init_idx].long())
  File "/home/mburu/anaconda3/envs/TabSurvey/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/mburu/anaconda3/envs/TabSurvey/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/mburu/anaconda3/envs/TabSurvey/lib/python3.8/site-packages/torch/nn/modules/sparse.py", line 162, in forward
    return F.embedding(
  File "/home/mburu/anaconda3/envs/TabSurvey/lib/python3.8/site-packages/torch/nn/functional.py", line 2233, in embedding
    return torch.embedding(weight, input, padding_idx, scale_grad_by_freq, sparse)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Trial 3 failed with value None.
